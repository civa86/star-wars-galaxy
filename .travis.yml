language: node_js
node_js:
- 8
cache:
  directories:
  - node_modules
branches:
  only:
  - master
before_script:
  - npm install -g coveralls
  # - npm install -g coveralls lighthouse
script:
  - npm test
  - npm run build-css
  - npm run build
after_script:
  - 'if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then npm run coverage && cat ./coverage/lcov.info | coveralls; fi'
before_deploy:
  - export VERSION="`node -p -e "require('./package.json').version"`"
  - export TAG="v.$VERSION.build.$TRAVIS_BUILD_NUMBER"
  - echo "$TAG" > build/static/version.txt
  - zip -r star-wars-galaxy.zip build/*
  - git config --local user.name "civa86"
  - git config --local user.email "dario.civallero@gmail.com"
  - git tag "$TAG"
deploy:
#   # PUBLISH ON FIREBASE
#   - provider: firebase
#     token:
#       secure: "YOUR ENCRYPTED token"
#     message: "your message"
#     skip_cleanup: true
#   # UPLOAD RELEASE ARTIFACT
  - provider: releases
    api_key: "$GH_TOKEN"
    file: "star-wars-galaxy.zip"
    skip_cleanup: true
# # AFTER DEPLOY: Audit and upload to gist
# after_deploy:
#   - lighthouse --output json --output-path lighthouse.report.json <URL>
#   - export REPORT=`cat lighthouse.report.json`
#   - "curl -v --request PATCH -H \"Authorization: token $GH_TOKEN\" -d \"{\"files\": {\"$GIST_FILE\": {\"content\": \"$REPORT\"}}}\" $GIST_URL"
env:
  global:
  - GIST_URL=https://api.github.com/gists/f01219ac55a43bb2d52657f959a98acc
  - GIST_FILE=star-wars-galaxy.lighthouse.report.json
  - secure: oxkVcRiIaQ9SuBfByWWSxL0Sw3sB9Z49K6Ypq5HSYJbIXcXLDjhkOLaI0qNnuFvmNgTlEdhM5T9jf7g4wLAauCsPA7A1Ljy+yWZcZfSf8UrzWtspCAKacwmt8Y9Z+8ByMdPmkJitS7kLEGP+Mvb+eFwKbnBUcOXZZApSL6WUNnzfjQW/WnaCcdM80mI2glM16NSwAyHf9W0hoUgJjVP5AG/J9N1fRVSitoWPCsdmbK1JlMCoRH+GCatsdznNaHmuiTVmtwhtTKXJ+qR4RI1xG09mODQAHeg+AWIok+TgpEzEdkM1geoXc/MJk745KD/TlnYINeVvNqzCkWWdJfzyjQC2CocIm+43XLKxZSL7yQ301lrq9vpTVLVFJjr+MKxhaCOnbxbb6IQu3Vn4sJcIBcT0/agDWn+ywWlw3TFLbMTbjofVO1Igau1e3pUIEWmtVvwytJiU8UPgW/d35fz4FxjuKuNjet4zQunX06FuAvRrL+OKNuwqtFQqfHkIye8LN2q+76iLKPU6yhSgFIKD6s8ntktrsdZbrlx/h+WvELbQJ28Fs7zxNlkcsJkWdVaMiJaQSRV8a0Ye7dlIyqdxCL574kEW0N/nIidzdHN4WkVPjOKoXUQdgNw+XAg2YVvHTg3N9t/yJfcgUYQP9RezeSbwgbj+gtwEnR7Q2jUGxhQ=
